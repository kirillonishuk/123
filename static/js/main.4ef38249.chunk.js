(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{3:function(e){e.exports={bot:{type:"web"},url:{dev:"wss://localhost:3015",prod:"wss://193.124.114.63:3015"}}},36:function(e,t,n){e.exports=n(79)},41:function(e,t,n){},68:function(e,t){},71:function(e,t,n){},73:function(e,t,n){},79:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(33),s=n.n(r),i=(n(41),n(9)),c=n(10),m=n(13),l=n(11),u=n(14),p=n(34),g=n.n(p),d=n(12),f=n.n(d),b=(n(71),n(73),n(35)),h=n.n(b),v=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(m.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).createFile=function(){var e=new Blob([n.props.file],{type:n.props.mime||h.a.lookup(n.props.name.split(".")[1])});return URL.createObjectURL(e)},n.renderButtons=function(){return n.props.buttons.map(function(e,t){return o.a.createElement("div",{className:"answer-button",key:t,onClick:function(t){return n.props.sendMessage(t,e.text)}},e.text)})},n.linkify=function(e){return e.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a href="$&" target="_blank">$&</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>').replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/gim,'<a href="mailto:$&" target="_blank">$&</a>')},n.renderTime=function(){return o.a.createElement("div",{className:"message-time"},n.props.time.getHours()+":"+n.props.time.getMinutes())},n.renderMessage={message:function(e){return o.a.createElement("div",{className:e},o.a.createElement("span",{dangerouslySetInnerHTML:{__html:n.linkify(n.props.text)}}),n.renderTime())},image:function(e){return o.a.createElement("div",{className:e},o.a.createElement("img",{src:"data:image/png;base64,".concat(n.props.image),alt:"sending"}),n.renderTime())},file:function(e){return o.a.createElement("div",{className:e},o.a.createElement("a",{href:n.createFile(),download:n.props.name,className:"file-download"},n.props.name),o.a.createElement("div",{className:"file-size"},"".concat(n.props.file.byteLength," \u0431\u0430\u0439\u0442")),n.renderTime())},audio:function(e){return o.a.createElement("div",{className:e},o.a.createElement("audio",{controls:!0,className:"voice-msg"},o.a.createElement("source",{src:n.createFile(),type:n.props.mime})),n.renderTime())},keyboard:function(e){return o.a.createElement("div",{className:e},n.renderButtons(),n.renderTime())}},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=f()({"message-box":!this.props.buttons,"buttons-box":this.props.buttons,outgoing:"outgoing"===this.props.type,incoming:"incoming"===this.props.type,image:"image"===this.props.form});return this.renderMessage[this.props.form](e)}}]),t}(a.Component),y={"component-outgoing-message":function(e){return{text:e.text,type:"incoming",form:"message",time:new Date}},"component-ingoing-message":function(e){return{text:e.text,type:"outgoing",form:"message",time:new Date}},"component-keyboard":function(e){return{buttons:e.buttons,type:"incoming",form:"keyboard",time:new Date}},"component-outgoing-picture":function(e){return{image:e.image,filename:e.filename,type:"incoming",form:"image",time:new Date}},"component-ingoing-picture":function(e){return{image:e.image,filename:e.filename,type:"outgoing",form:"image",time:new Date}},"component-outgoing-audio":function(e){return{file:e.file,mime:e.mime,type:"incoming",form:"audio",time:new Date}},"component-outgoing-document":function(e){return{file:e.file,name:e.name,type:"incoming",form:"file",time:new Date}},default:function(e){return{text:e.text||"Error message!",type:"incoming",form:"message",time:new Date}}},w=function(e){return e.type in y?y[e.type](e):y.default(e)},E=n(3),x=function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(m.a)(this,Object(l.a)(t).call(this,e))).scrollToBottom=function(){n.chatbox&&(n.chatbox.scrollTop=n.chatbox.scrollHeight)},n.changeMessage=function(e){n.setState({text:e.target.value})},n.sendMessage=function(e,t){e.preventDefault(),e.stopPropagation();var a={bot:{type:E.bot.type,id:n.state.botId},user:n.state.userId,type:"message",text:t||n.state.text};n.socket.emit("web-chat",a),t||n.setState({text:""}),n.chat.disabled=!1,n.chat.focus()},n.startChat=function(e){e.preventDefault(),e.stopPropagation(),n.socket.emit("web-chat",{bot:{type:E.bot.type,id:n.state.botId},user:n.state.userId,text:"/start",type:"message"}),n.setState({botIsActive:!0}),n.chat.disabled=!1,n.chat.focus()},n.loadImage=function(e){var t=e.target.files,a=t[0].name,o=t[0];if(FileReader&&t&&t.length){var r=new FileReader;r.onload=function(){var e={bot:{type:E.bot.type,id:n.state.botId},user:n.state.userId,image:r.result.split(",")[1],filename:a,type:"picture"};n.socket.emit("web-chat",e)},r.readAsDataURL(o),e.target.value="",n.chat.focus()}else alert("Error!")},n.renderMessage=function(){return n.state.box.map(function(e,t){return o.a.createElement(v,Object.assign({sendMessage:n.sendMessage,key:t},e))})},n.renderInitButton=function(){if(!n.state.botIsActive)return o.a.createElement("div",{className:"init-bot-btn"},o.a.createElement("button",{onClick:n.startChat,className:"start-chat-btn"},o.a.createElement("i",{className:"zmdi zmdi-arrow-right"})),o.a.createElement("div",{className:"start-chat-info"},"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 ID \u0431\u043e\u0442\u0430 \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 \u0434\u043b\u044f \u043d\u0430\u0447\u0430\u043b\u0430 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441 \u043d\u0438\u043c."))},n.renderInput=function(){var e=f()({"blocker-hide":n.state.botIsActive,blocker:!0});return o.a.createElement("form",{className:"send-message-form",onSubmit:n.sendMessage},o.a.createElement("div",{className:e}),o.a.createElement("label",{htmlFor:"select-file",className:"custom-select-input-file"}),o.a.createElement("input",{type:"file",id:"select-file",accept:"image/*",onChange:n.loadImage,disabled:!n.state.botIsActive}),o.a.createElement("input",{ref:function(e){return n.chat=e},className:"message-input",value:n.state.text,onChange:n.changeMessage,type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435...",disabled:!n.state.botIsActive}),o.a.createElement("div",{className:"send-message-button",onClick:n.sendMessage}))},n.state={botId:"",userId:crypto.getRandomValues(new Uint32Array(1)).toString()+"-"+(new Date).getTime().toString(),text:"",box:[],botIsActive:!1};var a=E.url.prod;return n.socket=g()(a,{path:"/ws",transports:["websocket"]}),n.socket.on("web-bot-message",function(e){var t=w(e);n.setState({box:n.state.box.concat(t)})}),n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e,t){this.state.box.length!==t.box.length&&this.scrollToBottom()}},{key:"componentWillUnmount",value:function(){this.socket.close()}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"chat-container"},o.a.createElement("form",{className:"bot-connection-container",onSubmit:this.startChat,autoComplete:"off"},o.a.createElement("label",{htmlFor:"bot-id-input"},"ID \u0411\u043e\u0442\u0430: "),o.a.createElement("input",{autoFocus:!0,type:"text",id:"bot-id-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 ID",value:this.state.botId,onChange:function(t){e.setState({botId:t.target.value})}})),o.a.createElement("div",{className:"message-container",ref:function(t){e.chatbox=t}},o.a.createElement("div",{className:"scroll-fix"}),this.renderInitButton(),this.renderMessage()),this.renderInput())}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[36,2,1]]]);
//# sourceMappingURL=main.4ef38249.chunk.js.map